{
  "name": "Automated AI Lead Enrichment: Salesforce to Explorium for Enhanced Prospect Data",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "leadCreated"
      },
      "id": "7b9667bd-8245-42e9-ac26-ffe57270b047",
      "name": "Salesforce Trigger",
      "type": "n8n-nodes-base.salesforceTrigger",
      "position": [
        -912,
        128
      ],
      "typeVersion": 1,
      "credentials": {
        "salesforceOAuth2Api": {}
      }
    },
    {
      "parameters": {
        "operation": "update",
        "leadId": "={{ $('Salesforce Trigger').item.json.Id}}",
        "updateFields": {
          "city": "={{ $json.city || null }}",
          "company": "={{ $json.company_name || null }}",
          "country": "={{ $json.country_name || null }}",
          "email": "={{ $json.professions_email || null }}",
          "mobilePhone": "={{ $json.mobile_phone }}",
          "phone": "={{ $json.phone_numbers?.[0]?.phone_number || \"null\" }}\n",
          "state": "={{ $json.region_name || '' }}",
          "title": "={{ $json.experience?.[0]?.title?.name || null }}",
          "website": "={{ $json.experience?.[0]?.company?.website || null }}"
        }
      },
      "id": "fa2866a7-fcf5-4548-8f11-646ab2fa51c6",
      "name": "Update Lead",
      "type": "n8n-nodes-base.salesforce",
      "position": [
        496,
        128
      ],
      "typeVersion": 1,
      "credentials": {
        "salesforceOAuth2Api": {}
      }
    },
    {
      "parameters": {
        "jsCode": "const allItems = $input.all();\nconst prospectIds = allItems.map(item => \n  item.json.matched_prospects.map(prospect => prospect.prospect_id)\n).flat();\n\nreturn [{\n  json: {\n    prospect_ids: prospectIds\n  }\n}];"
      },
      "id": "210875ef-3a63-424e-91b4-33d352d3db59",
      "name": "Extract Prospect IDs from Matched Results",
      "type": "n8n-nodes-base.code",
      "position": [
        -256,
        128
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "6896e951-8d66-41b1-87a5-a96d2e049675",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              },
              "leftValue": "={{ $json.matched_prospects.some(prospect => prospect.prospect_id !== null).toBoolean() }}",
              "rightValue": "null"
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "b53e0084-5680-4a2a-a5b9-4e46dd8b041f",
      "name": "Filter non-matched",
      "type": "n8n-nodes-base.filter",
      "position": [
        -464,
        128
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "jsCode": "const items = [];\n\nfor (const item of $input.all()) {\n  if (item.json.enriched_data && item.json.enriched_data.length > 0) {\n    items.push({\n      json: {\n        prospect_id: item.json.enriched_data[0].prospect_id,\n        ...item.json.enriched_data[0].data\n      }\n    });\n  }\n}\n\nreturn items;"
      },
      "id": "4787e9f4-8235-462f-9ffa-72a183fe9664",
      "name": "Code - flatten",
      "type": "n8n-nodes-base.code",
      "position": [
        224,
        128
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "content": "## Workflow Overview\n\n### Node 1: Salesforce Trigger\nThis node listens for real-time events from the connected Salesforce account, specifically monitoring for new lead creation events.\n\n- **Event**: leadCreated\n- **Trigger Type**: Real-time webhook\n\nOnce triggered, the node passes metadata about the newly created lead to the next step in the flow.\n\n### Node 2: Match_prospect\nThis node sends the lead's data to Explorium's AI-powered prospect matching API in real time.\n\n- **Method**: POST\n- **Endpoint**: https://api.explorium.ai/v1/prospects/match\n- **Authentication**: Generic Header Auth (using a configured credential)\n- **Headers**: Content-Type: application/json\n\nThe request body is dynamically built from lead data, typically including: full_name, company_name, email, phone_number, linkedin. These fields are matched against Explorium's intelligence graph to return enriched or validated profiles.\n\n**Response Output**: total_matches, matched_prospects, and a prospect_id. Each response is used downstream to enrich and update lead information.\n\n### Node 3: Filter non-matched\nThis node filters the output from the Match_prospect step to ensure that only valid, matched results continue in the flow. Only records that contain at least one matched prospect with a non-null prospect_id are passed forward.\n\n**Filter Logic**: Keeps only leads that have successful prospect matches from Explorium\n\n### Node 4: Extract Prospect IDs from Matched Results\nThis node extracts all valid prospect_id values from previously matched prospects and compiles them into a flat array. It loops over all matched items, extracts each prospect_id from the matched_prospects array and returns a single object with an array of all prospect_ids.\n\n### Node 5: Explorium Enrich Contacts Information\nThis node performs bulk enrichment of contacts by querying Explorium with a list of matched prospect_ids.\n\n**Node Configuration:**\n- **Method**: POST\n- **Endpoint**: https://api.explorium.ai/v1/prospects/contacts_information/bulk_enrich\n- **Authentication**: Header Auth (using saved credentials)\n- **Headers**: \"Content-Type\": \"application/json\", \"Accept\": \"application/json\"\n\nReturns enriched contact information, such as:\n- **emails**: professional/personal email addresses\n- **phone_numbers**: mobile and work numbers\n- **professions_email**, **professional_email_status**, **mobile_phone**\n\n### Node 6: Explorium Enrich Profiles\nThis additional enrichment node provides supplementary contact data enhancement, running in parallel with the primary enrichment process to maximize data collection from different Explorium endpoints.\n\n### Node 7: Merge\nThis node combines multiple data streams from the parallel enrichment processes into a single output, allowing you to consolidate data from different Explorium enrichment endpoints. The \"combine\" setting indicates it will merge the incoming data streams rather than overwriting them.\n\n### Node 8: Code - flatten\nThis custom code node processes and transforms the merged enrichment data before updating the Salesforce lead. It can be used to:\n- Flatten nested data structures from Explorium responses\n- Format data according to Salesforce field requirements\n- Apply business logic or data validation\n- Map Explorium fields to Salesforce lead properties\n- Handle data type conversions and null values\n\n### Node 9: Update Lead\nThis final node updates the original lead in Salesforce using the enriched data returned by Explorium.\n\n- **Credential**: Salesforce OAuth2 or Username/Password\n- **Resource**: Lead\n- **Operation**: Update Lead\n\nThe node updates the existing lead record with enriched information including additional contact details, professional data, and enhanced company information obtained through the Explorium enrichment process.",
        "height": 1780,
        "width": 760,
        "color": 4
      },
      "id": "7c787669-8605-4a4e-8df7-0cd173de7854",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -352,
        608
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "# Automatically enrich leads in Salesforce using Explorium MCP\n\nThis n8n workflow streamlines the process of enriching lead information by automatically detecting new leads created in Salesforce, processing them through Explorium's AI-powered tools, and updating the same leads back in Salesforce with enhanced prospect details.\n\n## Credentials Required\n\nTo use this workflow, set up the following credentials in your n8n environment:\n\n### Salesforce\n- **Type**: OAuth2 or Username/Password\n- **Used for**: triggering on new leads, updating lead records\n\n### Explorium API\n- **Type**: Generic Header Auth\n- **Header**: Authorization\n- **Value**: Bearer YOUR_TOKEN_HERE\n\nGo to Settings â†’ Credentials, create these two credentials, and assign them in the respective nodes before running the workflow.",
        "height": 620,
        "width": 640,
        "color": 6
      },
      "id": "10d3214f-389e-4f90-bc4a-46d56c72b5a7",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1104,
        608
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Workflow Flow Summary\n\n1. **Trigger**: Salesforce webhook triggers on new lead creation\n2. **Match**: Find prospect matches using Explorium based on lead data\n3. **Filter**: Keep only successfully matched prospects\n4. **Extract**: Compile prospect IDs for bulk enrichment\n5. **Enrich**: Parallel enrichment of contact information through multiple Explorium endpoints\n6. **Merge**: Combine enrichment results into unified data\n7. **Transform**: Flatten and prepare data for Salesforce update (Code node)\n8. **Update**: Update the original lead record in Salesforce with enriched data\n\nThis workflow ensures comprehensive lead enrichment while maintaining data quality and providing seamless integration within your Salesforce environment. The parallel enrichment structure maximizes data collection efficiency, and the filtering ensures only high-quality matches are processed, resulting in enhanced lead records with valuable prospect intelligence.",
        "height": 620,
        "width": 600
      },
      "id": "f171641a-78cc-4e5d-97b3-25db10e76e00",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        496,
        608
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "operation": "match",
        "type": "prospects",
        "useJsonInput": true,
        "jsonInput": "={{\n  {\n    \"prospects_to_match\": [{\n      \"full_name\": $json.FirstName + ' ' + $json.LastName,\n      \"company_name\": $json.Company,\n      \"email\": $json.Email\n    }]\n  }\n}}"
      },
      "type": "@exploriumai/n8n-nodes-explorium-ai.exploriumApiNode",
      "typeVersion": 1,
      "position": [
        -704,
        128
      ],
      "id": "7384c08e-c19a-4e48-a89a-f8b15ea61ae9",
      "name": "Explorium API",
      "credentials": {
        "exploriumApi": {}
      }
    },
    {
      "parameters": {
        "operation": "enrich",
        "type": "prospects",
        "enrichment": [
          "contacts",
          "profiles"
        ],
        "useJsonInput": true,
        "jsonInput": "={{ { \"prospect_ids\": $json.prospect_ids } }}"
      },
      "type": "@exploriumai/n8n-nodes-explorium-ai.exploriumApiNode",
      "typeVersion": 1,
      "position": [
        -16,
        128
      ],
      "id": "9c8e556a-34e5-4866-8739-1930c425765a",
      "name": "Explorium API1",
      "credentials": {
        "exploriumApi": {}
      }
    }
  ],
  "pinData": {
    "Salesforce Trigger": [
      {
        "json": {
          "attributes": {
            "type": "Lead",
            "url": "/services/data/v59.0/sobjects/Lead/00QQJ00000MSy7p2AD"
          },
          "Id": "00QQJ00000MSy7p2AD",
          "Company": "Explorium",
          "FirstName": "ziv",
          "LastName": "nadil",
          "Street": null,
          "PostalCode": null,
          "City": null,
          "Email": "ziv.nadil@explorium.ai",
          "Status": "Connected"
        }
      }
    ]
  },
  "connections": {
    "Code - flatten": {
      "main": [
        [
          {
            "node": "Update Lead",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter non-matched": {
      "main": [
        [
          {
            "node": "Extract Prospect IDs from Matched Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Salesforce Trigger": {
      "main": [
        [
          {
            "node": "Explorium API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Prospect IDs from Matched Results": {
      "main": [
        [
          {
            "node": "Explorium API1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Explorium API1": {
      "main": [
        [
          {
            "node": "Code - flatten",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Explorium API": {
      "main": [
        [
          {
            "node": "Filter non-matched",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "b9635898-3447-4cb7-b002-7b65fc0da1c9",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "0a70652f43c1b29dd16c35b61a38fd31c8004f58bc7e723bf43262a797407c77"
  },
  "id": "bmpD7lpy41VJb94g",
  "tags": []
}